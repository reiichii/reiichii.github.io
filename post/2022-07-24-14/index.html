<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ISUCON12予選に参加しました。結果は散々だったのですが振り返りも兼ねて残しておこうと思います。
ISUCON12 オンライン予選、17:00の時点でスコアは凍結されました🚀 残時間 01:00:00のスコアはこちら！ #isucon pic.twitter.com/SGjrF9nBCR
&amp;mdash; ISUCON公式 (@isucon_official) July 23, 2022 ステータス 初出場 Python 1人チーム 2502点 目標は「闇雲に手を動かずに爪痕残す」でした。 爪痕は残せませんでした🪦
準備 やっていたこととしては以下です。
ISUCON11予選過去問解く alpやmysqlのslow query logなどの計測ツールを使えるようになっておくこと 6月に行われた事前講習とハンズオンへの参加 普段rubyさわらないので多少やりにくかったのですが、出て良かったです。 ISUCON用ansible playbookを用意 計測ツールの導入をスムーズに行うため準備していました タイムライン 09:40~ 配信視聴 予選問題の概要を聞く 10:00~ 開始 ポータルサイト一通り見る（感動した） 当日レギュレーションを読む マニュアルを読む 読みながらアプリケーションを触ったり、ユースケース図を書いて仕様を把握 サーバへのssh接続確認 11:00~ 準備 ソースコードをgit管理下に置く 初回ベンチマークを実行 フワッと改善の目星をつける サーバ構成をmysql用サーバとapplication用の2台構成に変更する 12:00~ 準備 計測ツールの導入 nginxの設定ファイルをgit管理下に配置し直す 13:00~13:30 お昼休憩 20分でご飯食べて10分昼寝。もうこの時点で結構疲れていた 午前中はアプリケーションコードをほとんど見れていない 13:30~ 準備の延長戦 nginxの設定ファイルを間違えており、修正箇所探しに時間を潰す 14:00~ 改善開始 アプリケーションのコードを眺める 14:30~16:30 改善案1.スロウクエリを潰す試み 16:30~17:30 改善案2.リクエスト数の多いエンドポイントの改善 17:30~ 改善案3.bulkinsertに書き換えてみる 17:45~ 再起動チェック 18:00~19:00 競技終了・配信で講評を聞く こうして振り返ってみると計測ツールをスムーズに導入できていれば+1hくらいコード読む時間を捻出できていましたね。ansibleを用意していたがちょこちょこ小さいエラーにはまって気がついたら1hほど経ってしまっていました。"><title>ISUCON12予選参加した</title><link rel=canonical href=https://reiichii.github.io/post/2022-07-24-14/><link rel=stylesheet href=/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css><meta property="og:title" content="ISUCON12予選参加した"><meta property="og:description" content="ISUCON12予選に参加しました。結果は散々だったのですが振り返りも兼ねて残しておこうと思います。
ISUCON12 オンライン予選、17:00の時点でスコアは凍結されました🚀 残時間 01:00:00のスコアはこちら！ #isucon pic.twitter.com/SGjrF9nBCR
&amp;mdash; ISUCON公式 (@isucon_official) July 23, 2022 ステータス 初出場 Python 1人チーム 2502点 目標は「闇雲に手を動かずに爪痕残す」でした。 爪痕は残せませんでした🪦
準備 やっていたこととしては以下です。
ISUCON11予選過去問解く alpやmysqlのslow query logなどの計測ツールを使えるようになっておくこと 6月に行われた事前講習とハンズオンへの参加 普段rubyさわらないので多少やりにくかったのですが、出て良かったです。 ISUCON用ansible playbookを用意 計測ツールの導入をスムーズに行うため準備していました タイムライン 09:40~ 配信視聴 予選問題の概要を聞く 10:00~ 開始 ポータルサイト一通り見る（感動した） 当日レギュレーションを読む マニュアルを読む 読みながらアプリケーションを触ったり、ユースケース図を書いて仕様を把握 サーバへのssh接続確認 11:00~ 準備 ソースコードをgit管理下に置く 初回ベンチマークを実行 フワッと改善の目星をつける サーバ構成をmysql用サーバとapplication用の2台構成に変更する 12:00~ 準備 計測ツールの導入 nginxの設定ファイルをgit管理下に配置し直す 13:00~13:30 お昼休憩 20分でご飯食べて10分昼寝。もうこの時点で結構疲れていた 午前中はアプリケーションコードをほとんど見れていない 13:30~ 準備の延長戦 nginxの設定ファイルを間違えており、修正箇所探しに時間を潰す 14:00~ 改善開始 アプリケーションのコードを眺める 14:30~16:30 改善案1.スロウクエリを潰す試み 16:30~17:30 改善案2.リクエスト数の多いエンドポイントの改善 17:30~ 改善案3.bulkinsertに書き換えてみる 17:45~ 再起動チェック 18:00~19:00 競技終了・配信で講評を聞く こうして振り返ってみると計測ツールをスムーズに導入できていれば+1hくらいコード読む時間を捻出できていましたね。ansibleを用意していたがちょこちょこ小さいエラーにはまって気がついたら1hほど経ってしまっていました。"><meta property="og:url" content="https://reiichii.github.io/post/2022-07-24-14/"><meta property="og:site_name" content="日々のあれこれφ(．．)"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="ISUCON"><meta property="article:published_time" content="2022-07-24T14:06:01+09:00"><meta property="article:modified_time" content="2022-07-24T14:06:01+09:00"><meta property="og:image" content="https://reiichii.github.io/post/2022-07-24-14/score_graph.png"><meta name=twitter:title content="ISUCON12予選参加した"><meta name=twitter:description content="ISUCON12予選に参加しました。結果は散々だったのですが振り返りも兼ねて残しておこうと思います。
ISUCON12 オンライン予選、17:00の時点でスコアは凍結されました🚀 残時間 01:00:00のスコアはこちら！ #isucon pic.twitter.com/SGjrF9nBCR
&amp;mdash; ISUCON公式 (@isucon_official) July 23, 2022 ステータス 初出場 Python 1人チーム 2502点 目標は「闇雲に手を動かずに爪痕残す」でした。 爪痕は残せませんでした🪦
準備 やっていたこととしては以下です。
ISUCON11予選過去問解く alpやmysqlのslow query logなどの計測ツールを使えるようになっておくこと 6月に行われた事前講習とハンズオンへの参加 普段rubyさわらないので多少やりにくかったのですが、出て良かったです。 ISUCON用ansible playbookを用意 計測ツールの導入をスムーズに行うため準備していました タイムライン 09:40~ 配信視聴 予選問題の概要を聞く 10:00~ 開始 ポータルサイト一通り見る（感動した） 当日レギュレーションを読む マニュアルを読む 読みながらアプリケーションを触ったり、ユースケース図を書いて仕様を把握 サーバへのssh接続確認 11:00~ 準備 ソースコードをgit管理下に置く 初回ベンチマークを実行 フワッと改善の目星をつける サーバ構成をmysql用サーバとapplication用の2台構成に変更する 12:00~ 準備 計測ツールの導入 nginxの設定ファイルをgit管理下に配置し直す 13:00~13:30 お昼休憩 20分でご飯食べて10分昼寝。もうこの時点で結構疲れていた 午前中はアプリケーションコードをほとんど見れていない 13:30~ 準備の延長戦 nginxの設定ファイルを間違えており、修正箇所探しに時間を潰す 14:00~ 改善開始 アプリケーションのコードを眺める 14:30~16:30 改善案1.スロウクエリを潰す試み 16:30~17:30 改善案2.リクエスト数の多いエンドポイントの改善 17:30~ 改善案3.bulkinsertに書き換えてみる 17:45~ 再起動チェック 18:00~19:00 競技終了・配信で講評を聞く こうして振り返ってみると計測ツールをスムーズに導入できていれば+1hくらいコード読む時間を捻出できていましたね。ansibleを用意していたがちょこちょこ小さいエラーにはまって気がついたら1hほど経ってしまっていました。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://reiichii.github.io/post/2022-07-24-14/score_graph.png"><link rel="shortcut icon" href=https://reiichii.github.io/img/egg.jpeg><script async src="https://www.googletagmanager.com/gtag/js?id=G-LKHQH1CW54"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LKHQH1CW54",{anonymize_ip:!1})}</script><style>@import 'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap';:root{--base-font-family:"Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif, var(--base-font-family)}</style></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=https://reiichii.github.io/img/egg.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🏠</span></figure><div class=site-meta><h1 class=site-name><a href=/>日々のあれこれφ(．．)</a></h1><h2 class=site-description></h2></div></header><ol class=social-menu><li><a href=https://github.com/reiichii target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/reiichii01 target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/page/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/page/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/page/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/2022-07-24-14/><img src=/post/2022-07-24-14/score_graph_hu1c45c6ba752b88bcb48fca24fcaa2fcb_322845_800x0_resize_box_3.png srcset="/post/2022-07-24-14/score_graph_hu1c45c6ba752b88bcb48fca24fcaa2fcb_322845_800x0_resize_box_3.png 800w, /post/2022-07-24-14/score_graph_hu1c45c6ba752b88bcb48fca24fcaa2fcb_322845_1600x0_resize_box_3.png 1600w" width=800 height=384 loading=lazy alt="Featured image of post ISUCON12予選参加した"></a></div><div class=article-details><header class=article-category><a href=/categories/%E5%8F%82%E5%8A%A0%E3%83%AC%E3%83%9D/ style=background-color:#ffb900;color:#fff>参加レポ</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/2022-07-24-14/>ISUCON12予選参加した</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jul 24, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>1 minute read</time></div></footer></div></header><section class=article-content><p>ISUCON12予選に参加しました。結果は散々だったのですが振り返りも兼ねて残しておこうと思います。</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>ISUCON12 オンライン予選、17:00の時点でスコアは凍結されました🚀 残時間 01:00:00のスコアはこちら！ <a href="https://twitter.com/hashtag/isucon?src=hash&ref_src=twsrc%5Etfw">#isucon</a> <a href=https://t.co/SGjrF9nBCR>pic.twitter.com/SGjrF9nBCR</a></p>&mdash; ISUCON公式 (@isucon_official) <a href="https://twitter.com/isucon_official/status/1550753842446630912?ref_src=twsrc%5Etfw">July 23, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><h2 id=ステータス>ステータス</h2><ul><li>初出場</li><li>Python</li><li>1人チーム</li><li>2502点</li></ul><p>目標は「闇雲に手を動かずに爪痕残す」でした。
爪痕は残せませんでした🪦</p><h2 id=準備>準備</h2><p>やっていたこととしては以下です。</p><ul><li>ISUCON11予選過去問解く<ul><li>alpやmysqlのslow query logなどの計測ツールを使えるようになっておくこと</li></ul></li><li>6月に行われた事前講習とハンズオンへの参加<ul><li>普段rubyさわらないので多少やりにくかったのですが、出て良かったです。</li></ul></li><li>ISUCON用ansible playbookを用意<ul><li>計測ツールの導入をスムーズに行うため準備していました</li></ul></li></ul><h2 id=タイムライン>タイムライン</h2><ul><li>09:40~ 配信視聴<ul><li>予選問題の概要を聞く</li></ul></li><li>10:00~ 開始<ul><li>ポータルサイト一通り見る（感動した）</li><li>当日レギュレーションを読む</li><li>マニュアルを読む</li><li>読みながらアプリケーションを触ったり、ユースケース図を書いて仕様を把握</li><li>サーバへのssh接続確認</li></ul></li><li>11:00~ 準備<ul><li>ソースコードをgit管理下に置く</li><li>初回ベンチマークを実行</li><li>フワッと改善の目星をつける</li><li>サーバ構成をmysql用サーバとapplication用の2台構成に変更する</li></ul></li><li>12:00~ 準備<ul><li>計測ツールの導入</li><li>nginxの設定ファイルをgit管理下に配置し直す</li></ul></li><li>13:00~13:30 お昼休憩<ul><li>20分でご飯食べて10分昼寝。もうこの時点で結構疲れていた</li><li>午前中はアプリケーションコードをほとんど見れていない</li></ul></li><li>13:30~ 準備の延長戦<ul><li>nginxの設定ファイルを間違えており、修正箇所探しに時間を潰す</li></ul></li><li>14:00~ 改善開始<ul><li>アプリケーションのコードを眺める</li></ul></li><li>14:30~16:30 改善案1.スロウクエリを潰す試み</li><li>16:30~17:30 改善案2.リクエスト数の多いエンドポイントの改善</li><li>17:30~ 改善案3.bulkinsertに書き換えてみる</li><li>17:45~ 再起動チェック</li><li>18:00~19:00 競技終了・配信で講評を聞く</li></ul><p>こうして振り返ってみると計測ツールをスムーズに導入できていれば+1hくらいコード読む時間を捻出できていましたね。ansibleを用意していたがちょこちょこ小さいエラーにはまって気がついたら1hほど経ってしまっていました。</p><p>今回の目標が闇雲に手を動かさないだったので、一応自分なりに根拠や狙いを持っていたつもりだったのですが、講評を聞く感じ的が外れていました。</p><h3 id=改善案0サーバの役割分担>改善案0.サーバの役割分担</h3><p>サーバ構成をmysql用サーバとapplication用の2台構成に変更しました。</p><p>初回ベンチ実行時にtopの出力を眺めていたのですが、dbとpythonがcpuを食い潰しあっているように見えたため。先に分けた方が今後変化追いやすいかなと思ったというのもあります。</p><p>分けたことにより+500点ほどスコアが改善しました。goからpythonにしたときに下がった分が元に戻っただけなので実質プラマイ0ですね。</p><h3 id=改善案1料金集計処理のスロウクエリを潰す試み>改善案1.料金集計処理のスロウクエリを潰す試み</h3><ul><li>adminとorg系リクエストの配点が高いこと</li><li>adminの一覧画面とorgの請求情報一覧画面が異様に重かったこと</li><li>スロウクエリログで一番重かったクエリが、上記二つのリクエスト時に実行されるクエリだったこと</li></ul><p>から、この処理を改善すればパフォーマンスが大きく改善するのではと着手することにしました。</p><p>それ自体は良かったのですが、 処理が参照しているデータ源がmysqlとsqliteに分かれていることからどうしたら良いものかと手が動かず。sqliteをmysqlに載せ替えるといった選択肢は効果が見込めるかどうか分からなかったので実施に踏み切れませんでした。</p><p>mysql側の改善をしようと検索件数を必要な分だけに絞ったりしていたのですが、ベンチマーカーによる整合性チェックでエラーが出てしまいました。この処理の改善に2hほどかけてしまっていたので中断することにしました。</p><p><a class=link href=https://github.com/reiichii/isucon12-qualify/commit/855a3be79efea20a55c1bd6f6a04bb1f3d050d19 target=_blank rel=noopener>ログ</a></p><h3 id=改善案2-playerのリーダーボード一覧エンドポイントを改善する試み>改善案2. playerのリーダーボード一覧エンドポイントを改善する試み</h3><ul><li>alpでリクエストを集計したところ合計レスポンスタイムが一番多かったのはplayerのリーダーボード一覧エンドポイントだったこと</li><li>ベンチマーカーの出力に「leaderboardの表示に1秒以上かかったため2人の参加者が離脱しました。」のように出ていたこと</li></ul><p>player系エンドポイントは、先ほどのadminやorg系エンドポイントと異なり加算は少ないのですが、上記の理由からここを改善すれば少なくともスコアがそれなりに改善される見込みがありました。</p><p>ただ参照先がsqliteのデータで、パフォーマンス改善ってどうやるんだと首を捻る羽目に。調べてみたらsqliteにもインデックスの概念があり、DB初期化スクリプトのcreate table sql見たところインデックスは貼られていなかったので試しに貼って見たのですが、ほとんどスコアに影響はありませんでした。</p><p>まだ改善の余地はあったのかもですが、この時点で残り1hを切ってしまっていたため一旦深追いをやめてしまいました。</p><p><a class=link href=https://github.com/reiichii/isucon12-qualify/commit/82167412532d0dd2e789c27afb5ed6187d427c3b target=_blank rel=noopener>ログ</a></p><h3 id=改善案3-forでinsertしている箇所をbulkinsertさせる>改善案3. forでinsertしている箇所をbulkinsertさせる</h3><p>残り時間が微妙だったので、ソースコード眺めているときに気になっており、すぐに改善できそうな箇所として <code>/api/organizer/players/add</code> のinsert処理を書き換えようと思いました。実施して見たもののベンチマーカーがこけました。単純に書き換えるだけだと後続処理が意図した形に動かなかくなってしまうことに後から気づきました。</p><p>そもそもアプローチ方法が間違えていたのか、後続処理も合わせてなんとかする余地があったのか、残りが15分と検討する時間がもうなかったので中断しました。</p><p><a class=link href=https://github.com/reiichii/isucon12-qualify/commit/e9bc7671bb06d673cb8a4061841e457da5d236ac target=_blank rel=noopener>ログ</a></p><h2 id=問題の所感>問題の所感</h2><ul><li>「mysqlで準備していたからpostgresqlとかだったらきついな..まあスポンサーにmysqlがいるからないか」とか思っていたらまさかのmysql+sqliteでびっくり</li><li>auto_incrementのところも何か変なコードがあるなぁとは思っていたのですが、料金表とリーダーボード表示の箇所にばかり気を取られていたので全然見れませんでした</li><li>講評で「インデックスを貼ればdbの負荷がひとまずは下がる」ようなことが言われていて、もう少しDB周りを重点的に確認すれば良かったです。見ていた箇所のクエリのインデックスは確認していたつもりだったのですがそうではなく、出てきたスロークエリに対してインデックスが効いているかを見ておくべきでした</li><li>lockがやたら多いのも気にはなっていたのですが、トランザクションを使う箇所というのが出てきませんでした。ただの知見不足です</li><li>ユースケース図を書いていたのですが、アプリの全体像を網羅的に把握するのに役立ちました。アプリケーションとdbのやりとり周りも何かしらの方法でスムーズに把握できるようになれると良かったのですが</li></ul><h2 id=その他感想>その他感想</h2><ul><li>ISUCON11予選問題を解いていた時はアプリケーションの使用の仕様が難しく、何やっていいか全く分からない状態でした。それに比べたら今回の問題はまだその辺りの把握はしやすかったです</li><li>ポータルサイトがどんなものかずっと見てみたかったので感動しました。終わった後速攻で選手用ページが見れなくなってしまい、ベンチマークのログやダッシュボードのスクショを取り損ねてしまいました</li><li>終わった後眼精疲労でくたくたで、速攻でpc閉じてしまったのですが、DCの方では感想戦で盛り上がっていて他の参加者のバイタリティの高さを感じました。翌朝読み返していて面白く、復習時の参考にまた読み返そうと思います</li><li>集中力は8h意外と持ちました。1h~1h30minにつき5minの休憩を無理やり設けるようにして良かったです</li></ul><h2 id=おわりに>おわりに</h2><p>無念 : 楽しかった！ が 6:4の気持ちです。</p><p>あと目と手と頭が足りないです。本戦一人出場している人の凄さを実感します。私がアプリケーション側でもう少しまともに戦えるようになったら、次回は誰か誘ってみるのもありかもなと思えてしまいました。</p><p>今年もPythonでの本戦出場選手は出なかったのでPythonで狙いたいなと思う反面、業務で触らないgoの勉強の口実にしたいという気持ちのが強いので、来年はgoで10000点以上出すことを目標に出てみたいと思います。ベンチマーカーがgoで書かれていて、その辺りの処理ももう少し読めるようになりたいんですよね。</p><p>運営の皆様、開催ありがとうございました。</p><p><a class=link href=https://github.com/reiichii/isucon12-qualify target=_blank rel=noopener>https://github.com/reiichii/isucon12-qualify</a></p><p><a class=link href=https://github.com/reiichii/isucon12-qualify/issues/1 target=_blank rel=noopener>計測ログ</a></p><p><img src=/post/2022-07-24-14/score_graph.png width=2336 height=1122 srcset="/post/2022-07-24-14/score_graph_hu1c45c6ba752b88bcb48fca24fcaa2fcb_322845_480x0_resize_box_3.png 480w, /post/2022-07-24-14/score_graph_hu1c45c6ba752b88bcb48fca24fcaa2fcb_322845_1024x0_resize_box_3.png 1024w" loading=lazy alt=上げられなかった class=gallery-image data-flex-grow=208 data-flex-basis=499px></p><p><img src=/post/2022-07-24-14/usecase.jpg width=4032 height=3024 srcset="/post/2022-07-24-14/usecase_hu8aac09e64bc6d0d3413f56a86150a826_1612266_480x0_resize_q75_box.jpg 480w, /post/2022-07-24-14/usecase_hu8aac09e64bc6d0d3413f56a86150a826_1612266_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=こんなアプリケーションでした(?) class=gallery-image data-flex-grow=133 data-flex-basis=320px></p></section><footer class=article-footer><section class=article-tags><a href=/tags/isucon/>ISUCON</a></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/post/2022-07-13-22/><div class=article-details><h2 class=article-title>ISUCON11-qualifyのログインページが開かなかった</h2></div></a></article><article><a href=/post/2022-06-07-20/><div class=article-details><h2 class=article-title>ISUCON12事前講習</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2022 日々のあれこれφ(．．)</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#ステータス>ステータス</a></li><li><a href=#準備>準備</a></li><li><a href=#タイムライン>タイムライン</a><ul><li><a href=#改善案0サーバの役割分担>改善案0.サーバの役割分担</a></li><li><a href=#改善案1料金集計処理のスロウクエリを潰す試み>改善案1.料金集計処理のスロウクエリを潰す試み</a></li><li><a href=#改善案2-playerのリーダーボード一覧エンドポイントを改善する試み>改善案2. playerのリーダーボード一覧エンドポイントを改善する試み</a></li><li><a href=#改善案3-forでinsertしている箇所をbulkinsertさせる>改善案3. forでinsertしている箇所をbulkinsertさせる</a></li></ul></li><li><a href=#問題の所感>問題の所感</a></li><li><a href=#その他感想>その他感想</a></li><li><a href=#おわりに>おわりに</a></li></ul></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>